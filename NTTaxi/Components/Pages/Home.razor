@page "/"
@using NTTaxi.Libraries.Models.Gsms

<div class="flex min-h-screen items-center justify-center bg-gray-900 p-2 text-gray-100">
    <div class="w-full max-w-3xl rounded-2xl bg-gray-800 p-6 shadow-lg">
        <div class="mb-6 text-center text-2xl font-bold text-green-400">DASHBOARD</div>

        <div class="grid grid-cols-1 gap-4">

            <!-- Ali Service -->
            <div class="flex items-center justify-between rounded-xl bg-gray-700 p-4 shadow">
                <div>
                    <h2 class="text-lg font-semibold">ALI Control Panel</h2>
                    <p class="text-sm text-gray-400">
                        Đồng bộ lúc 05:30 - @aliActivity
                        <span class="font-bold @(aliWorker.IsRunning ? "text-green-400" : "text-red-400")">
                            @(aliWorker.IsRunning ? "Running" : "Stopped")
                        </span>
                    </p>
                </div>
                <div class="flex gap-2">
                    <button class="rounded-lg bg-green-500 px-4 py-2 text-white hover:bg-green-600"
                            @onclick="AliStart">
                        Start
                    </button>
                    <button class="rounded-lg bg-red-500 px-4 py-2 text-white hover:bg-red-600"
                            @onclick="AliStop">
                        Stop
                    </button>
                </div>
            </div>

            <!-- Vetc Service -->
            <div class="flex items-center justify-between rounded-xl bg-gray-700 p-4 shadow">
                <div>
                    <h2 class="text-lg font-semibold">VETC Control Panel</h2>
                    <p class="text-sm text-gray-400">
                        Đồng bộ lúc 03:30 - @vetcActivity
                        <span class="font-bold @(vetcWorker.IsRunning ? "text-green-400" : "text-red-400")">
                            @(vetcWorker.IsRunning ? "Running" : "Stopped")
                        </span>
                    </p>
                </div>
                <div class="flex gap-2">
                    <button class="rounded-lg bg-green-500 px-4 py-2 text-white hover:bg-green-600"
                            @onclick="VetcStart">
                        Start
                    </button>
                    <button class="rounded-lg bg-red-500 px-4 py-2 text-white hover:bg-red-600"
                            @onclick="VetcStop">
                        Stop
                    </button>
                </div>
            </div>

            <!-- Gsm Service -->
            <div class="flex items-center justify-between rounded-xl bg-gray-700 p-4 shadow">
                <div>
                    <h2 class="text-lg font-semibold">GSM Control Panel</h2>
                    <p class="text-sm text-gray-400">
                        Đồng bộ lúc 05:30 - @gsmActivity
                        <span class="font-bold @(gsmRunning ? "text-green-400" : "text-red-400")">
                            @(gsmRunning ? "Running" : "Stopped")
                        </span>
                    </p>
                </div>
                <div class="flex gap-2">
                    <button class="rounded-lg bg-green-500 px-4 py-2 text-white hover:bg-green-600"
                            @onclick="() => GsmStart()">
                        Start
                    </button>
                    <button class="rounded-lg bg-red-500 px-4 py-2 text-white hover:bg-red-600"
                            @onclick="() => GsmStop()">
                        Stop
                    </button>
                </div>
            </div>

        </div>
    </div>
</div>

@code {
    private bool gsmRunning = false;
    private void ToggleGSM(bool start) => gsmRunning = start;

    [Inject] private IAliWorker aliWorker { get; set; } = default!;
    [Inject] private IVetcWorker vetcWorker { get; set; } = default!;
    private string aliActivity = "";
    private string gsmActivity = "";
    private string vetcActivity = "";

    private void AliStart()
    {
        try
        {
            aliWorker.Start();
            aliActivity = $"Hoạt động!";
        }
        catch (Exception ex)
        {
            aliActivity = $"Lỗi: {ex.Message}";
        }
    }

    private void AliStop()
    {
        try
        {
            aliWorker.Stop();
            aliActivity = $"Dừng hoạt động!";
        }
        catch (Exception ex)
        {
            aliActivity = $"Lỗi: {ex.Message}";
        }
    }

    private void VetcStart()
    {
        try
        {
            vetcWorker.Start();
            vetcActivity = $"Hoạt động!";
        }
        catch (Exception ex)
        {
            vetcActivity = $"Lỗi: {ex.Message}";
        }
    }

    private void VetcStop()
    {
        try
        {
            vetcWorker.Stop();
            vetcActivity = $"Dừng hoạt động!";
        }
        catch (Exception ex)
        {
            vetcActivity = $"Lỗi: {ex.Message}";
        }
    }

    private void GsmStart()
    {
        try
        {
            gsmActivity = $"Hoạt động!";
            ToggleGSM(true);
        }
        catch (Exception ex)
        {
            gsmActivity = $"Lỗi: {ex.Message}";
        }
    }

    private void GsmStop()
    {
        try
        {
            gsmActivity = $"Dừng hoạt động!";
            ToggleGSM(false);
        }
        catch (Exception ex)
        {
            gsmActivity = $"Lỗi: {ex.Message}";
        }
    }
}